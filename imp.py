import os
import pefile

# Đường dẫn đến thư mục chứa tệp tin cần tính imphash
directory = '/home/hoang-20520514/Desktop/DoAnCoChe/1000_third_files/infected_files_3'
output_file = './imp2.txt'
# Lấy danh sách tệp tin trong thư mục
file_list = os.listdir(directory)
imphashes = []
# Lặp qua từng tiệp tin trong danh sách và tính imphash
for filename in file_list:
    full_path = os.path.join(directory, filename)
    if os.path.isfile(full_path):
        try:
            # Sử dụng thư viện pefile để đọc tệp PE và tính imphash
            pe = pefile.PE(full_path)
            imphash = pe.get_imphash()

            # Lưu trữ imphash vào một danh sách hoặc tệp tin
            # Ví dụ: lưu trữ vào danh sách
            imphashes.append(imphash)
        except pefile.PEFormatError:
            # Xử lý ngoại lệ nếu tệp không phải là tệp PE
            pass
with open(output_file, 'w') as f:
    for imphash in imphashes:
        f.write(imphash + '\n')
 

